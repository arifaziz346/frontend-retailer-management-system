import{r as d,j as h,p as L,l as z,c as r,a as t,b as p,u as w,A as U,w as k,v as N,f,F as j,q as F,n as W,o as n,t as l,e as S,s as C,B as O}from"./index-DppJ4uJc.js";import{a as x}from"./axios-pwxHYZIu.js";import{_ as A}from"./Pagination-hmH0ImhT.js";import{_ as q}from"./SalePrint-BFjvZnRv.js";import{_ as Q}from"./BaseModal-DaTHTPvo.js";import{V as M}from"./vue-spinner-tail-D8qEx31J.js";import{u as G}from"./useFormErrors-BWkWHfi_.js";import{c as H}from"./stringHelpers-DhATn_QK.js";import{S as J}from"./sweetalert2.esm.all-BQxta0Da.js";import{t as K}from"./toast-kIWbnzaY.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useAboutStore-9IUuUeWX.js";const Y={key:0,class:"fixed inset-0 flex items-center justify-center bg-white/70 backdrop-blur-sm z-[60]"},Z={class:"flex flex-col items-center gap-3"},ee={key:1,class:"w-full min-h-screen bg-gray-50 p-2 sm:p-4"},te={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},se={class:"bg-white border-b border-gray-100 p-4 flex flex-col md:flex-row md:items-center justify-between gap-4"},ae={class:"relative w-full md:w-96"},oe={key:0,class:"overflow-x-auto"},re={key:0,class:"flex flex-col items-center gap-3"},ne={class:"w-full text-sm text-left"},le={class:"divide-y divide-gray-100 bg-white"},ie={class:"px-6 py-4"},ce={class:"font-mono font-bold text-gray-700"},de={class:"px-6 py-4"},ue={class:"flex flex-col"},pe={class:"font-semibold text-gray-900"},fe={class:"flex items-center gap-2 text-xs text-gray-500 mt-0.5"},xe={key:0},me={class:"px-6 py-4"},ge={key:0,class:"px-2.5 py-1 rounded-full text-[10px] font-bold uppercase bg-gray-100 text-gray-500 border border-gray-200"},_e={class:"px-6 py-4 text-center"},be={class:"bg-gray-100 text-gray-700 px-2 py-0.5 rounded font-bold text-xs"},ye={class:"px-6 py-4 text-sm"},ve={class:"flex flex-col"},he={class:"text-gray-900 font-black"},we={key:0,class:"text-[10px] text-orange-500 font-medium"},ke={class:"px-6 py-4"},Se={class:"flex items-center justify-center gap-2"},Ce=["onClick"],Ve=["onClick"],Re={key:1,class:"flex flex-col items-center justify-center py-20 px-4 text-center"},Ne={class:"bg-gray-50 border-t border-gray-100 px-4 py-3"},je={class:"p-4"},Fe=["value"],Me={key:1,class:"mt-2 text-xs text-red-600 italic"},Pe={__name:"SaleList",setup(Te){const y=d(null),m=d(!1),u=d(!1),v=d(!1),g=d(!1),_=d(""),V=d(""),i=h({sales:[],return_reasons:[],pagination:{}}),o=h({sale_id:null,cancel_reason_id:"",custom_reason:"",is_reason_empty:!1}),c=h({return_reason_id:!1}),P=G(c);L(_,()=>{g.value=!0,V.value=_.value,b(1)});const b=async(a=1)=>{u.value=!g.value;try{const e=await x.get("/sales",{params:{page:a,search:V.value||null}});i.sales=e.data.data.data,i.pagination=e.data.data}catch(e){console.error("fetching error",e)}finally{u.value=!1,g.value=!1}},T=async()=>{u.value=!0;try{const a=await x.get("/return_reasons");i.return_reasons=a.data.data}catch(a){console.log("feting error",a)}finally{u.value=!1}};async function $(a){o.sale_id=a,o.cancel_reason="",m.value=!0,o.sale_id=a,Object.keys(c).forEach(e=>c[e]="")}const B=async a=>{v.value=!0;try{let e="";o.cancel_reason_id===11&&(e=o.custom_reason);const s=await x.post("/sales/return",{sale_id:o.sale_id,return:1,return_reason_id:o.cancel_reason_id,cancel_reason:e});s.data.success&&(m.value=!1,I(),b(),K.success(s.data.message)),console.log("return successfull")}catch(e){P(e)}finally{v.value=!1}},D=async a=>{const e=await x.post(`return_reasons/${a}`);J.fire("Cancel Reason",e.data.data.cancel_reason,"fail")},E=async a=>{try{const e=await x.get(`/sales/${a}`,{params:{search:a}});console.log("Print Sale Response --->",e.data.data.data);const s=e.data.data.data.find(R=>R.id===a);if(!s)return;y.value&&y.value.print(s)}catch(e){console.error("Print error",e)}},I=()=>{o.cancel_reason="",Object.keys(c).forEach(a=>c[a]=""),o.cancel_reason_id="",o.custom_reason="",o.is_reason_empty=!1};return z(async()=>{await T(),await b()}),(a,e)=>u.value?(n(),r("div",Y,[t("div",Z,[p(w(M),{size:"48px",color:"#2563eb"}),e[6]||(e[6]=t("span",{class:"text-blue-600 font-semibold animate-pulse"},"Loading Sales...",-1))])])):(n(),r("div",ee,[t("div",te,[t("div",se,[e[8]||(e[8]=U('<div class="flex items-center gap-2" data-v-9a3bcf4e><div class="bg-blue-600 p-2 rounded-lg" data-v-9a3bcf4e><i class="pi pi-shopping-cart text-white text-lg" data-v-9a3bcf4e></i></div><div data-v-9a3bcf4e><h1 class="text-lg font-bold text-gray-800 leading-tight" data-v-9a3bcf4e>Sales Management</h1><p class="text-xs text-gray-500" data-v-9a3bcf4e>View and manage your transaction history</p></div></div>',1)),t("div",ae,[e[7]||(e[7]=t("span",{class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},[t("i",{class:"pi pi-search text-gray-400 text-sm"})],-1)),k(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>_.value=s),onInput:e[1]||(e[1]=(...s)=>a.handleSearch&&a.handleSearch(...s)),placeholder:"Search by Customer, ID, or Phone...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm transition-all outline-none"},null,544),[[N,_.value]])])]),i.sales.length?(n(),r("div",oe,[g.value?(n(),r("div",re,[p(w(M),{size:"15px",color:"#2563eb"}),e[9]||(e[9]=t("span",{class:"text-blue-600 font-sm animate-pulse"},"Searching...",-1))])):f("",!0),t("table",ne,[e[12]||(e[12]=t("thead",{class:"bg-gray-50 text-gray-500 uppercase text-[11px] font-bold tracking-wider"},[t("tr",null,[t("th",{class:"px-6 py-4"},"Invoice #"),t("th",{class:"px-6 py-4"},"Date & Customer"),t("th",{class:"px-6 py-4"},"Payment Type"),t("th",{class:"px-6 py-4 text-center"},"Items"),t("th",{class:"px-6 py-4"},"Financials"),t("th",{class:"px-6 py-4 text-center"},"Actions")])],-1)),t("tbody",le,[(n(!0),r(j,null,F(i.sales,s=>(n(),r("tr",{key:s.id,class:"hover:bg-blue-50/30 transition-colors"},[t("td",ie,[t("span",ce,"#"+l(s.id),1)]),t("td",de,[t("div",ue,[t("span",pe,l(Number(s.credit)===1&&s.customer?.name||"Walk-in Customer"),1),t("div",fe,[t("span",null,[e[10]||(e[10]=t("i",{class:"pi pi-calendar text-[10px]"},null,-1)),S(" "+l(s.sale_date||"-"),1)]),s.customer?.phone_one?(n(),r("span",xe,"â€¢ "+l(s.customer.phone_one),1)):f("",!0)])])]),t("td",me,[s.return===1?(n(),r("span",ge," Canceled ")):(n(),r("span",{key:1,class:C([Number(s.credit)===1?"bg-red-50 text-red-600 border-red-100":"bg-green-50 text-green-600 border-green-100","px-2.5 py-1 rounded-full text-[10px] font-bold uppercase border"])},l(Number(s.credit)===1?"Credit":"Cash Sale"),3))]),t("td",_e,[t("span",be,l(s.total_items||0),1)]),t("td",ye,[t("div",ve,[t("span",he,"Rs. "+l(s.total_amount||0),1),s.total_discount>0?(n(),r("span",we," Disc: Rs. "+l(s.total_discount),1)):f("",!0)])]),t("td",ke,[t("div",Se,[t("button",{onClick:R=>E(s.id),class:"flex items-center gap-1.5 px-3 py-1.5 bg-white border border-blue-600 text-blue-600 hover:bg-blue-600 hover:text-white rounded-lg text-xs font-bold transition-all"},[...e[11]||(e[11]=[t("i",{class:"pi pi-print"},null,-1),S(" Print ",-1)])],8,Ce),t("button",{onClick:()=>s.return===1?D(s.id):$(s.id),class:C([s.return===1?"bg-gray-400":"bg-red-500 hover:bg-red-600","flex items-center gap-1.5 px-3 py-1.5 text-white rounded-lg text-xs font-bold transition-all shadow-sm"])},[t("i",{class:C(s.return===1?"pi pi-info-circle":"pi pi-times-circle")},null,2),S(" "+l(s.return===1?"Reason":"Cancel"),1)],10,Ve)])])]))),128))])])])):(n(),r("div",Re,[...e[13]||(e[13]=[t("div",{class:"bg-gray-50 p-6 rounded-full mb-4"},[t("i",{class:"pi pi-search-plus text-5xl text-gray-300"})],-1),t("h2",{class:"text-xl font-bold text-gray-700"},"No Transactions Found",-1),t("p",{class:"text-gray-500 text-sm max-w-xs mx-auto mt-1"}," We couldn't find any sales matching your current criteria. Try adjusting your filters. ",-1)])])),t("div",Ne,[p(A,{pagination:i.pagination,onPageChange:b},null,8,["pagination"])])]),p(Q,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=s=>m.value=s),title:"Cancel Transaction",onSave:e[5]||(e[5]=s=>B()),disableSaveBtn:v.value},{default:W(()=>[t("div",je,[e[15]||(e[15]=t("div",{class:"flex items-center gap-3 p-3 bg-red-50 text-red-700 rounded-lg mb-4"},[t("i",{class:"pi pi-exclamation-triangle text-xl"}),t("p",{class:"text-xs font-semibold uppercase"},"This action will return items to stock and void the payment.")],-1)),e[16]||(e[16]=t("label",{class:"block mb-2 text-sm font-bold text-gray-700"},"Why are you canceling this sale?",-1)),k(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.cancel_reason_id=s),class:"bg-white border border-gray-300 text-sm rounded-lg block w-full p-3 outline-none focus:ring-2 focus:ring-red-500 transition-all"},[e[14]||(e[14]=t("option",{value:"",disabled:""},"Select a professional reason",-1)),(n(!0),r(j,null,F(i.return_reasons,s=>(n(),r("option",{key:s.id,value:s.id},l(s.title),9,Fe))),128))],512),[[O,o.cancel_reason_id]]),o.cancel_reason_id===11?k((n(),r("textarea",{key:0,"onUpdate:modelValue":e[3]||(e[3]=s=>o.custom_reason=s),rows:"3",class:"mt-3 bg-white border border-gray-300 text-sm rounded-lg block w-full p-3 outline-none focus:ring-2 focus:ring-red-500 transition-all",placeholder:"Please describe the specific issue..."},null,512)),[[N,o.custom_reason]]):f("",!0),c.return_reason_id?(n(),r("p",Me," * "+l(w(H)(c.return_reason_id)),1)):f("",!0)])]),_:1},8,["modelValue","disableSaveBtn"]),p(q,{ref_key:"printRef",ref:y},null,512)]))}},Qe=X(Pe,[["__scopeId","data-v-9a3bcf4e"]]);export{Qe as default};
