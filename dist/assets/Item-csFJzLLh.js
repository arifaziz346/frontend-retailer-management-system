import{a as w}from"./axios-CBe-jvwZ.js";import{l as se,c as d,o as u,f as q,a as t,t as c,F as P,x as B,u as j,H as T,I as L,w as E,C as H,r as y,v as le,k as M,s as oe,m as ae,A as re,b as g,q as A,z as ne,e as D,i as ie,y as O,J as de}from"./index-C8Fn62vO.js";import{V as ue}from"./vue-spinner-tail-DWFvjD4p.js";import{_ as R}from"./BaseModal-Cva2b2EO.js";import{_ as $}from"./FormInput-C07fgCAP.js";import{c as ce}from"./stringHelpers-DhATn_QK.js";import{_ as pe}from"./Pagination-B1sPuT5Y.js";import{t as I}from"./toast-BWxgGeSH.js";import{u as me}from"./useFormErrors-BWkWHfi_.js";import{p as ge}from"./helper-B0BtwXvx.js";import{_ as fe}from"./lodash-cMsVoU0a.js";const be={class:"flex flex-col"},ye=["for"],xe=["id","value","disabled"],ve={key:0,value:""},_e=["value"],he={key:1,class:"text-red-600 text-sm mt-1"},we={__name:"Selector",props:{id:String,label:String,modelValue:[String,Number],options:{type:[Array,Object],required:!0},placeholder:{type:String,default:""},error:String,disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(i,{emit:v}){const f=i,p=v,x=se(()=>Array.isArray(f.options)?f.options.map(a=>typeof a=="object"?{label:a.label??a.name??a.value,value:a.value??a.id??a.label}:{label:a,value:a}):Object.entries(f.options).map(([a,k])=>({label:k,value:a}))),o=a=>{p("update:modelValue",a.target.value)};return(a,k)=>(u(),d("div",be,[i.label?(u(),d("label",{key:0,for:i.id,class:"text-xs lg:text-sm font-medium mb-1"},c(i.label),9,ye)):q("",!0),t("select",{id:i.id,value:i.modelValue,disabled:i.disabled,onChange:o,class:"placeholder:italic placeholder:text-slate-400 block bg-white w-full border border-slate-300 rounded-md py-1.5 pl-3 pr-10 shadow-sm focus:outline-none focus:border-sky-500 focus:ring-sky-500 focus:ring-1 sm:text-sm"},[i.placeholder?(u(),d("option",ve,c(i.placeholder),1)):q("",!0),(u(!0),d(P,null,B(x.value,(n,m)=>(u(),d("option",{key:m,value:n.value},c(n.label),9,_e))),128))],40,xe),i.error?(u(),d("p",he,c(j(ce)(i.error)),1)):q("",!0)]))}},ke={class:"flex items-start gap-2 w-full"},Ve={class:"flex-1 min-w-0"},Ce={class:"block text-sm font-medium mb-1"},Se={class:"relative w-auto"},$e=["value"],Ue={__name:"TypeSelector",props:T({label:{type:String,default:"Select"},sub_categories:{type:Array,default:()=>[]},error:String,button_name:{type:String,default:"Add"},show_button:{type:Boolean,default:!0}},{modelValue:{default:"other"},modelModifiers:{}}),emits:T(["click_sub_category"],["update:modelValue"]),setup(i,{emit:v}){const f=L(i,"modelValue"),p=v;return(x,o)=>(u(),d("div",ke,[t("div",Ve,[t("label",Ce,c(i.label),1),t("div",Se,[E(t("select",{"onUpdate:modelValue":o[0]||(o[0]=a=>f.value=a),class:"placeholder:italic placeholder:text-slate-400 block bg-white w-full border border-slate-300 rounded-md py-1.5 pl-3 pr-10 shadow-sm focus:outline-none focus:border-sky-500 focus:ring-sky-500 focus:ring-1 sm:text-sm"},[o[2]||(o[2]=t("option",{value:"other"},"Other",-1)),(u(!0),d(P,null,B(i.sub_categories,a=>(u(),d("option",{key:a.id,value:a.id},c(a.category_name),9,$e))),128))],512),[[H,f.value]])])]),i.show_button?(u(),d("button",{key:0,class:"mt-6 bg-green-600 hover:bg-green-700 text-white px-4 py-1.5 rounded-md shadow-sm border border-green-700",onClick:o[1]||(o[1]=a=>p("click_sub_category"))},c(i.button_name),1)):q("",!0)]))}},Ie={class:"flex flex-row justify-between sm:flex-row items-center gap-1 w-full"},qe={class:"w-1/8"},Pe=["value"],Be={class:"relative w-full sm:w-1/4"},Me={key:0,class:"pi pi-search absolute right-3 bottom-2.5 text-gray-400"},Ae={__name:"FilterBar",props:{subCategories:{type:Array,default:()=>[]},showButton:{type:Boolean,default:!0}},emits:["update:search","update:category_id","click_add_category"],setup(i,{emit:v}){const f=v,p=y(""),x=y(""),o=()=>{f("update:search",p.value),f("update:category_id",x.value)},a=()=>{p.value="",o()};return(k,n)=>(u(),d("div",Ie,[t("div",qe,[E(t("select",{"onUpdate:modelValue":n[0]||(n[0]=m=>x.value=m),onChange:o,class:"placeholder:italic placeholder:text-slate-400 block bg-white w-full border border-slate-300 rounded-md py-1.5 pl- pr-10 shadow-sm focus:outline-none focus:border-sky-500 focus:ring-sky-500 focus:ring-1 sm:text-sm"},[n[2]||(n[2]=t("option",{value:""},"All Categories",-1)),(u(!0),d(P,null,B(i.subCategories,m=>(u(),d("option",{key:m.id,value:m.id},c(m.category_name),9,Pe))),128))],544),[[H,x.value]])]),t("div",Be,[E(t("input",{"onUpdate:modelValue":n[1]||(n[1]=m=>p.value=m),onInput:o,type:"text",placeholder:"Search Item...",class:"placeholder:italic placeholder:text-slate-400 block bg-white w-full border border-slate-300 rounded-md py-1.5 pl-3 pr-10 shadow-sm focus:outline-none focus:border-sky-500 focus:ring-sky-500 focus:ring-1 sm:text-sm"},null,544),[[le,p.value]]),p.value?(u(),d("i",{key:1,onClick:a,class:"pi pi-times absolute right-3 bottom-2.5 text-gray-400 cursor-pointer"})):(u(),d("i",Me))])]))}},je={key:0,class:"fixed inset-0 flex items-center justify-center bg-slate-900/10 backdrop-blur-md z-[100]"},Ee={class:"flex flex-col items-center p-8 bg-white rounded-3xl shadow-2xl border border-white"},Ne={key:1,class:"flex flex-col min-h-screen bg-[#f8fafc] w-full"},Fe={class:"sticky top-0 z-30 w-full bg-white border-b border-slate-200 shadow-sm"},ze={class:"w-full px-4 sm:px-8 py-4 flex flex-col md:flex-row md:items-center justify-between gap-4"},Te={class:"flex flex-col"},De={class:"flex items-center space-x-2 text-xs font-bold text-slate-400 uppercase tracking-wider mb-1"},Oe={class:"text-blue-600"},Re={class:"w-full px-4 sm:px-8 py-6"},Le={class:"w-full mb-8"},He={key:0,class:"bg-white border border-slate-200 rounded-2xl shadow-sm overflow-hidden w-full"},Ge={class:"overflow-x-auto w-full"},Je={class:"w-full text-left border-collapse min-w-[1000px]"},Qe={class:"divide-y divide-slate-50"},We={class:"px-6 py-4"},Ye={class:"flex flex-col"},Ke={class:"font-bold text-slate-800 text-base group-hover:text-blue-700 transition-colors"},Xe={class:"text-xs font-mono text-slate-400 mt-1"},Ze={class:"px-6 py-4"},et={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-slate-100 text-slate-600 border border-slate-200"},tt={class:"px-6 py-4"},st={class:"text-sm font-bold text-slate-700"},lt={class:"text-[11px] text-slate-400 font-medium tracking-tight"},ot={class:"px-6 py-4"},at={class:"flex items-baseline gap-2"},rt={class:"text-sm font-black text-green-600 tracking-tighter"},nt={class:"text-[10px] font-bold text-green-500/80 bg-green-50 px-1.5 py-0.5 rounded"},it={class:"px-6 py-4"},dt={class:"flex flex-col gap-1.5"},ut={class:"flex justify-between text-[10px] font-bold uppercase tracking-tighter"},ct={class:"w-full bg-slate-100 h-2 rounded-full overflow-hidden border border-slate-200/50"},pt={class:"px-6 py-4 text-right"},mt={class:"flex justify-end items-center gap-1"},gt=["onClick"],ft=["onClick"],bt=["onClick","disabled"],yt={class:"bg-slate-50/50 px-8 py-4 border-t border-slate-100"},xt={key:1,class:"w-full py-32 flex flex-col items-center justify-center bg-white border-2 border-dashed border-slate-200 rounded-[2rem]"},vt={class:"grid grid-cols-1 md:grid-cols-2 gap-6 p-2"},_t={class:"md:col-span-2"},ht={class:"space-y-2"},wt={class:"flex gap-2"},At={__name:"Item",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(i){const v=re(),f=ie(),p=y(!1);L(i,"modelValue");const x=y(0),o=M({items:[],units:[],categories:[],pagination:{currentPage:1,nextPageUrl:null,prevPageUrl:null,lastPage:1}}),a=y(),k=y(),n=y(!1),m=y(!1),_=y(!1),V=y(""),C=y(!1),U=y(""),r=M({name:"",category_id:a.value,sale_price:"",cost_price:"",stock:"",quantity_in_stock:"",unit:""}),h=M({name:"",sale_price:"",category_id:"",cost_price:"",quantity_in_stock:"",unit:"",new_quantity_in_stock:""}),N=me(h),G=fe.debounce(()=>{m.value=!0,S()},500);oe([U,a],()=>{G()});const J=()=>{f.push("/admin/unit")},S=async(l="/items")=>{try{m.value?m.value=!0:n.value=!0;const e=await w.get(l,{params:{search:U.value||null,category_id:a.value||null}});console.log("Items fetched:",e.data);const b=e.data.data;o.items=b.data,o.pagination.currentPage=b.current_page,o.pagination.lastPage=b.last_page,o.pagination.nextPageUrl=b.next_page_url,o.pagination.prevPageUrl=b.prev_page_url}catch(e){console.log("Error fetching items:",e)}finally{n.value=!1,m.value=!1}},Q=async()=>{try{const l=await w.get("/categories");o.categories=l.data.categories}catch(l){console.log("Error fetching categories:",l)}},F=()=>{r.name="",r.sale_price="",r.cost_price="",r.unit="",r.category_id=a.value||0,Object.keys(h).forEach(l=>h[l]=""),C.value=!1,_.value=!1,V.value=""},W=l=>{_.value=!0,V.value=l.id,r.name=l.name,r.sale_price=l.sale_price,r.cost_price=l.cost_price,r.unit=l.unit,r.category_id=l.category_id,C.value=!0},Y=async()=>{n.value=!0;try{const l={name:r.name,sale_price:r.sale_price,cost_price:r.cost_price,quantity_in_stock:r.quantity_in_stock,unit:r.unit,category_id:r.category_id};let e;if(_.value?e=await w.put(`/items/${V.value}`,l):e=await w.post("/items",l),!_.value)o.items.unshift(e.data.item);else{const b=o.items.findIndex(s=>s.id===V.value);b!==-1&&(o.items[b]=e.data.item)}e.data.success&&(S(),I.success(e.data.message||(_.value?"Item updated successfully":"Item created successfully")),F())}catch(l){console.error("Error saving/updating item:",l),N(l)}finally{n.value=!1}},K=async l=>{if(confirm("Are you sure you want to delete this item?")){n.value=!0;try{const e=await w.delete(`/items/${l}`);o.items=o.items.filter(b=>b.id!==l),e.data.success&&I.success(e.data.message||(_.value?"Item updated successfully":"Item created successfully"))}catch(e){console.error("Error deleting item:",e),I.error("Failed to delete item")}finally{n.value=!1}}},X=()=>{f.push("/admin/category")},Z=async()=>{try{const l=await w.get("/units");o.units=l.data.data,console.log("Units fetched:",o.units)}catch(l){console.log("Error fetching units:",l)}},ee=async l=>{V.value=l.id,p.value=!0},te=async()=>{n.value=!0;try{const l=await w.post("/item/update/stock",{new_quantity:x.value,item_id:V.value});l.data.success&&(p.value=!1,I.success(l.data.message),x.value=0,S())}catch(l){N(l)}finally{n.value=!1}};return ae(async()=>{a.value=v.params.id||0,k.value=v.params.category_name||"",r.category_id=a.value,await S(),await Q(),await Z()}),(l,e)=>{const b=ne("router-link");return n.value?(u(),d("div",je,[t("div",Ee,[g(j(ue),{size:"50px",color:"#2563eb"}),e[15]||(e[15]=t("p",{class:"text-slate-500 text-xs font-bold mt-4 tracking-[0.2em] uppercase"},"Processing Data",-1))])])):(u(),d("div",Ne,[t("header",Fe,[t("div",ze,[t("div",Te,[t("nav",De,[g(b,{to:"/admin/Item",class:"hover:text-blue-600 transition-colors"},{default:A(()=>[...e[16]||(e[16]=[D("Inventory",-1)])]),_:1}),e[17]||(e[17]=t("i",{class:"pi pi-chevron-right text-[10px]"},null,-1)),t("span",Oe,c(k.value||"All Categories"),1)]),e[18]||(e[18]=t("h1",{class:"text-2xl font-black text-slate-800 tracking-tight"},"Product Management",-1))]),t("button",{class:"inline-flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 active:scale-95 text-white px-6 py-3 rounded-xl font-bold shadow-lg shadow-blue-200 transition-all text-sm",onClick:e[0]||(e[0]=()=>{F(),_.value=!1,C.value=!0,l.addVariant()})},[...e[19]||(e[19]=[t("i",{class:"pi pi-plus-circle"},null,-1),t("span",null,"Create New Item",-1)])])])]),t("main",Re,[t("div",Le,[g(Ae,{subCategories:o.categories,search:U.value,"onUpdate:search":e[1]||(e[1]=s=>U.value=s),category_id:a.value,"onUpdate:category_id":e[2]||(e[2]=s=>a.value=s),showButton:!1,class:"w-full"},null,8,["subCategories","search","category_id"])]),o.items&&o.items.length?(u(),d("div",He,[t("div",Ge,[t("table",Je,[e[24]||(e[24]=t("thead",null,[t("tr",{class:"bg-slate-50/80 text-slate-500 uppercase text-[11px] font-bold tracking-widest border-b border-slate-100"},[t("th",{class:"px-6 py-5"},"Product Info"),t("th",{class:"px-6 py-5"},"Category"),t("th",{class:"px-6 py-5"},"Pricing (Cost/Sale)"),t("th",{class:"px-6 py-5"},"Profit Analysis"),t("th",{class:"px-6 py-5 w-[200px]"},"Inventory Health"),D(),t("th",{class:"px-6 py-5 text-right"},"Actions")])],-1)),t("tbody",Qe,[(u(!0),d(P,null,B(o.items,s=>(u(),d("tr",{key:s.id,class:"hover:bg-blue-50/40 transition-all group"},[t("td",We,[t("div",Ye,[t("span",Ke,c(s.name),1),t("span",Xe,"#"+c(s.unique_barcode||s.id),1)])]),t("td",Ze,[t("span",et,c(s.category?.category_name||"General"),1)]),t("td",tt,[t("div",st,"Rs."+c(s.sale_price),1),t("div",lt,"Net Cost: Rs."+c(s.cost_price),1)]),t("td",ot,[t("div",at,[t("span",rt,"+"+c((s.sale_price-s.cost_price).toFixed(0)),1),t("span",nt,c(j(ge)(s.sale_price,s.cost_price)),1)])]),t("td",it,[t("div",dt,[t("div",ut,[t("span",{class:O(s.quantity_in_stock<10?"text-red-500":"text-slate-500")},c(s.quantity_in_stock||0)+" "+c(s.unit||"pcs"),3),e[20]||(e[20]=t("span",{class:"text-slate-400"},"Target: 100",-1))]),t("div",ct,[t("div",{class:O(["h-full rounded-full transition-all duration-1000",[s.quantity_in_stock>20?"bg-blue-500":s.quantity_in_stock>5?"bg-amber-400":"bg-red-500"]]),style:de({width:Math.min(s.quantity_in_stock/100*100,100)+"%"})},null,6)])])]),t("td",pt,[t("div",mt,[t("button",{onClick:z=>W(s),class:"p-2 hover:bg-blue-100 text-blue-600 rounded-lg transition-colors"},[...e[21]||(e[21]=[t("i",{class:"pi pi-pencil text-sm"},null,-1)])],8,gt),t("button",{onClick:z=>K(s.id),class:"p-2 hover:bg-red-100 text-red-500 rounded-lg transition-colors"},[...e[22]||(e[22]=[t("i",{class:"pi pi-trash text-sm"},null,-1)])],8,ft),t("button",{onClick:z=>ee(s),disabled:n.value,class:"text-sm bg-blue-600 text-white p-1 rounded disabled:bg-gray-400"},c(n.value?"Wait...":"Update-Stock"),9,bt)])]),e[23]||(e[23]=t("td",{class:"px-6 py-4 text-right"},null,-1))]))),128))])])]),t("div",yt,[g(pe,{pagination:o.pagination,onPageChange:S},null,8,["pagination"])])])):(u(),d("div",xt,[e[25]||(e[25]=t("div",{class:"p-6 bg-slate-50 rounded-full mb-4"},[t("i",{class:"pi pi-box text-5xl text-slate-300"})],-1)),e[26]||(e[26]=t("h3",{class:"text-xl font-bold text-slate-800"},"Your inventory is empty",-1)),e[27]||(e[27]=t("p",{class:"text-slate-500 mb-6"},"Start tracking your products by clicking the button below.",-1)),t("button",{onClick:e[3]||(e[3]=s=>C.value=!0),class:"text-blue-600 font-bold hover:text-blue-700"},"+ Add First Product")]))]),g(R,{modelValue:C.value,"onUpdate:modelValue":e[10]||(e[10]=s=>C.value=s),title:_.value?"Modify Product Information":"Catalog New Item",onSave:e[11]||(e[11]=()=>Y()),disableSaveBtn:n.value,panelClass:"max-w-2xl"},{default:A(()=>[t("div",vt,[t("div",_t,[g($,{id:"name",label:"Item Name",modelValue:r.name,"onUpdate:modelValue":e[4]||(e[4]=s=>r.name=s),placeholder:"Enter product name...",error:h.name},null,8,["modelValue","error"])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," New Stock (Quantity) ",-1)),g($,{id:"quantity_in_stock",type:"number",modelValue:r.quantity_in_stock,"onUpdate:modelValue":e[5]||(e[5]=s=>r.quantity_in_stock=s),error:h.quantity_in_stock},null,8,["modelValue","error"])]),g(Ue,{modelValue:r.category_id,"onUpdate:modelValue":e[6]||(e[6]=s=>r.category_id=s),sub_categories:o.categories||[],error:h?.category_id,button_name:"+ New",label:"Category",onClick_sub_category:X},null,8,["modelValue","sub_categories","error"]),t("div",ht,[e[30]||(e[30]=t("label",{class:"block text-sm font-bold text-slate-700"},"Unit of Measure",-1)),t("div",wt,[g(we,{id:"unit",modelValue:r.unit,"onUpdate:modelValue":e[7]||(e[7]=s=>r.unit=s),options:o.units.map(s=>({label:s.name,value:s.name})),placeholder:"Select Unit",class:"flex-1",error:h.unit},null,8,["modelValue","options","error"]),t("button",{onClick:J,class:"p-2 bg-slate-100 rounded-lg hover:bg-slate-200"},[...e[29]||(e[29]=[t("i",{class:"pi pi-plus"},null,-1)])])])]),g($,{modelValue:r.cost_price,"onUpdate:modelValue":e[8]||(e[8]=s=>r.cost_price=s),label:"Cost Price (Base)",type:"number"},null,8,["modelValue"]),g($,{modelValue:r.sale_price,"onUpdate:modelValue":e[9]||(e[9]=s=>r.sale_price=s),label:"Selling Price",type:"number"},null,8,["modelValue"])])]),_:1},8,["modelValue","title","disableSaveBtn"]),g(R,{modelValue:p.value,"onUpdate:modelValue":e[13]||(e[13]=s=>p.value=s),title:"Update Stock",onSave:e[14]||(e[14]=()=>te()),disableSaveBtn:n.value,panelClass:"max-w-2xl"},{default:A(()=>[g($,{id:"quantity_in_stock",type:"number",modelValue:x.value,"onUpdate:modelValue":e[12]||(e[12]=s=>x.value=s),error:h.new_quantity_in_stock},null,8,["modelValue","error"])]),_:1},8,["modelValue","disableSaveBtn"])]))}}};export{At as default};
