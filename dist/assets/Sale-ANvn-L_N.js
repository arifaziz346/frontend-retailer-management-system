import{r as i,k as C,l as L,m as oe,A as le,p as ne,c as d,a as s,b as c,u as S,F as q,x as N,e as re,t as p,q as B,i as ie,o as u,h as j,w as de,v as ue}from"./index-ZTB1Raef.js";import{S as ce}from"./SearchBar-BFjXWV27.js";import{_ as O}from"./BaseModal-D3tWCtYd.js";import{t as f}from"./toast-BWxgGeSH.js";import{V as D}from"./vue-spinner-tail-CkTNzA0u.js";import{a as T}from"./axios-CBe-jvwZ.js";import{_}from"./FormInput-DY9EFoZs.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                                                                  */import"./stringHelpers-DhATn_QK.js";const fe={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-[60]"},ge={class:"bg-white p-6 rounded-xl shadow-2xl"},xe={key:1,class:"w-full h-screen bg-gray-100 font-sans overflow-hidden"},_e={class:"flex flex-col lg:flex-row h-full"},be={class:"flex-1 flex flex-col min-w-0 bg-gray-100 border-r border-gray-200"},me={class:"bg-white p-3 shadow-sm flex flex-wrap items-center justify-between gap-3 z-20"},ye={class:"w-full md:w-72"},ve={class:"flex items-center gap-2"},he=["value"],we={class:"flex-1 overflow-y-auto p-4 custom-scrollbar"},ke={key:0},Ve={key:0,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-4"},Ce=["onClick"],Se={class:"h-20 flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-50 border-b border-gray-100"},qe={class:"w-10 h-10 rounded-lg bg-white shadow-sm flex items-center justify-center border border-blue-100 group-hover:scale-110 transition-transform duration-300"},Ne={class:"text-sm font-black text-blue-600 uppercase"},je={class:"p-3 flex-1 flex flex-col justify-between"},De={class:"text-[12px] font-bold text-gray-700 leading-tight line-clamp-2 mb-2"},Te={class:"flex items-center justify-between"},Ie={class:"text-blue-700 font-extrabold text-xs"},Ee={class:"text-[10px] text-gray-400 font-mono"},Pe={key:1,class:"flex justify-center items-center h-64"},Ue={key:1,class:"flex flex-col items-center justify-center h-full text-gray-400 opacity-60"},$e={class:"w-full lg:w-[380px] flex flex-col bg-white shadow-2xl z-30 h-full relative"},Re={class:"p-4 border-b border-gray-100 flex-shrink-0 bg-white"},Ae={class:"flex justify-between items-center"},Fe={class:"bg-blue-50 text-blue-600 text-xs font-bold px-3 py-1 rounded-full border border-blue-100"},Le={class:"flex-1 overflow-y-auto custom-scrollbar bg-white"},Be={key:0,class:"flex flex-col items-center justify-center h-full text-gray-300 p-10 text-center"},Oe={key:1,class:"w-full text-xs"},ze={class:"divide-y divide-gray-50"},Me={class:"px-4 py-3"},Qe={class:"font-bold text-gray-800"},Ye={class:"text-[10px] text-gray-400 mt-1"},He={class:"mt-2 flex items-center gap-1"},Ge=["onUpdate:modelValue","onInput"],Ke={class:"px-2 py-3"},We={class:"flex flex-col items-center gap-1"},Je={class:"flex items-center bg-gray-100 rounded p-0.5"},Xe=["onClick"],Ze=["value","onInput"],et=["onClick"],tt=["onClick"],st={class:"px-4 py-3 text-right font-black text-gray-900"},at={class:"flex-shrink-0 bg-gray-50 border-t border-gray-200 p-4 shadow-[0_-8px_15px_-5px_rgba(0,0,0,0.1)]"},ot={class:"space-y-1 mb-4"},lt={class:"flex justify-between text-[11px] text-gray-500"},nt={class:"font-bold"},rt={class:"flex justify-between text-[11px] text-yellow-600"},it={class:"font-bold"},dt={class:"flex justify-between items-center pt-2 mt-1 border-t border-gray-300"},ut={class:"text-xl font-black text-green-600"},ct={key:0,class:"flex justify-center py-2"},pt={key:1,class:"grid grid-cols-3 gap-2"},ft=["disabled"],gt=["disabled"],xt=["disabled"],_t={class:"p-4"},bt={class:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4"},mt={__name:"Sale",setup(yt){const r=i([]),I=i(null);i([]);const b=i(0),y=i(!1),E=i(""),P=i(""),v=i(!1),z=i("false"),h=i(!1),w=i(!1);i(!1);const M=ie(),Q=le(),o=C({items:[],item_Categories:[],credit:!1,customer_invoice:!1,customer_fast_pay:!1,update:!1,saleType:""}),m=i(!1);i(!1),i(!1);const U=i(0),g=C({name:"",phone_one:"",address:"",sale_date:""}),n=C({name:"",phone_one:"",address:"",remarks:"",sale_date:""}),k=async(a="/items")=>{try{y.value,y.value=!0;const e=await T.get(a,{params:{search:E.value||null,category_id:P.value||null}});console.log("response items-",e.data.data.data);const t=e.data.data;o.items=t.data,o.pagination.currentPage=t.current_page,o.pagination.lastPage=t.last_page,o.pagination.nextPageUrl=t.next_page_url,o.pagination.prevPageUrl=t.prev_page_url}catch(e){console.log("Error fetching items:",e)}finally{y.value=!1}},Y=async()=>{try{const a=await T.get("/categories");o.item_Categories=a.data.categories,console.log("response",o.item_Categories)}catch(a){console.log("Error fetching categories:",a)}},H=a=>{if(a.quantity_in_stock===null||a.quantity_in_stock===""||a.quantity_in_stock<=0){f.error("Stock is empty");return}var e={id:a.id,unit:a.unit,name:a.name,quantity:1,quantity_in_stock:a.quantity_in_stock,sale_price:a.sale_price,cost_price:a.cost_price,sale_price:a.sale_price,new_sale_price:0,categorie_id:a.categorie_id,discount:0};r.value.some(l=>l.id===a.id)?f.error("Item is al ready added in the cart"):r.value.push(e)},$=a=>{const e=Number(a.quantity_in_stock);return!(isNaN(e)||e<=0)},G=a=>{r.value=r.value.filter(t=>t.id!==a);let e=0;r.value.forEach(t=>{e+=Number(t.discount)||0}),b.value=e},K=a=>{const e=r.value.find(t=>t.id===a);if(e){if(!$(e)){f.error("Stock is empty");return}e.quantity<e.quantity_in_stock?e.quantity+=1:f.error("Quantity exceeds available stock")}},W=a=>{const e=r.value.find(t=>t.id===a);e&&(e.quantity>1?e.quantity-=1:f.error("Quantity cannot be less than 1"))},J=(a,e)=>{const t=r.value.find(ae=>ae.id===a);if(!t)return;const l=Number(e),x=Number(t.quantity_in_stock);if(!$(t)){f.error("Stock is empty"),t.quantity=1;return}if(isNaN(l)||l<1){f.error("Quantity cannot be less than 1"),t.quantity=1;return}if(l>x){f.error(`Only ${x} items available`),t.quantity=x;return}t.quantity=l},X=async a=>{E.value=a,k()},Z=a=>{const e=r.value.find(x=>x.id===a);if(!e)return;const t=Number(e.discount);if(isNaN(t)||t<0){f.error("Discount cannot be negative"),e.discount=0;return}if(t>e.quantity*e.sale_price){f.error("Discount exceeds total price"),e.discount=0;return}let l=0;r.value.forEach(x=>{l+=Number(x.discount)||0}),b.value=l},ee=a=>{const e=a.target.value;P.value=e,k()},R=i(!1),te=()=>{R.value=window.innerWidth<640};L(()=>({height:R.value===!1?`${U.value-227}px`:"auto"}));const A=L(()=>r.value.reduce((a,e)=>a+=e.sale_price*e.quantity,0)),F=async()=>{v.value=!0;try{let a=null,e=null;switch(o.saleType){case"CREDIT":a=1,e={...n};break;case"INVOICE":a=0,e={...n};break;default:a=null;break}const t={items:r.value,sale_date:n.sale_date,credit:a};e&&(t.customer=e),console.log("FINAL PAYLOAD =>",t);const l=await T.post("/sales",t);l.data.success&&(se(),f.success(l.data.message),M.push("sale-list"))}catch(a){if(a.response?.status===422){const e=a.response.data.errors;Object.keys(e).forEach(t=>{const l=t.split(".").pop();g.hasOwnProperty(l)&&(g[l]=e[t][0])})}}finally{v.value=!1}},se=()=>{n.name="",n.address="",n.sale_date="",n.remarks="",n.phone_one="",r.value=[],Object.keys(g).forEach(a=>g[a]=""),m.value=!1,h.value=!1,z.value=!1,b.value=0},V=()=>{U.value=window.innerHeight};return oe(()=>{if(te(),!n.sale_date){const a=new Date,e=a.getFullYear(),t=String(a.getMonth()+1).padStart(2,"0"),l=String(a.getDate()).padStart(2,"0");n.sale_date=`${e}-${t}-${l}T00:00`}I.value=Q.params.id||null,I.value!==null&&(o.update=!0,fetItemsForEdit()),k(),Y(),V(),window.addEventListener("resize",V)}),ne(()=>{window.removeEventListener("resize",V)}),(a,e)=>o.isLoading?(u(),d("div",fe,[s("div",ge,[c(S(D))])])):(u(),d("div",xe,[s("div",_e,[s("div",be,[s("div",me,[s("div",ye,[c(ce,{onInput:X})]),s("div",ve,[e[15]||(e[15]=s("label",{class:"text-[10px] font-bold uppercase text-gray-400"},"Category Filter",-1)),s("select",{id:"category",class:"h-9 border border-gray-300 rounded-md bg-white px-3 text-xs font-semibold outline-none focus:ring-2 focus:ring-blue-500",onChange:e[0]||(e[0]=t=>ee(t))},[e[14]||(e[14]=s("option",{value:""},"All Products",-1)),(u(!0),d(q,null,N(o.item_Categories,t=>(u(),d("option",{key:t.id,value:t.id},p(t.category_name),9,he))),128))],32)])]),s("div",we,[o.items.length>0?(u(),d("div",ke,[o.isLoading?(u(),d("div",Pe,[c(S(D))])):(u(),d("div",Ve,[(u(!0),d(q,null,N(o.items,t=>(u(),d("div",{key:t.id,onClick:j(l=>H(t),["prevent"]),class:"group relative flex flex-col bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-lg hover:border-blue-500 hover:-translate-y-1 cursor-pointer transition-all duration-300 overflow-hidden"},[s("div",Se,[s("div",qe,[s("span",Ne,p(t.name?t.name.substring(0,2):"IT"),1)])]),s("div",je,[s("p",De,p(t?.name||"Unnamed Product"),1),s("div",Te,[s("span",Ie," Rs. "+p(t?.sale_price||"0"),1),s("span",Ee,"#"+p(t.id),1)])])],8,Ce))),128))]))])):(u(),d("div",Ue,[...e[16]||(e[16]=[s("i",{class:"pi pi-search text-5xl mb-3"},null,-1),s("p",{class:"text-sm font-medium italic"},"No items found...",-1)])]))])]),s("div",$e,[s("div",Re,[s("div",Ae,[e[17]||(e[17]=s("h2",{class:"font-bold text-gray-800 text-lg flex items-center gap-2"},[s("i",{class:"pi pi-shopping-bag text-blue-600"}),re(" Cart ")],-1)),s("span",Fe,p(r.value.length)+" Items ",1)])]),s("div",Le,[r.value.length===0?(u(),d("div",Be,[...e[18]||(e[18]=[s("i",{class:"pi pi-shopping-cart text-5xl mb-4"},null,-1),s("p",{class:"text-xs font-bold uppercase tracking-widest"},"Cart is empty",-1)])])):(u(),d("table",Oe,[e[21]||(e[21]=s("thead",{class:"text-[10px] text-gray-400 uppercase bg-gray-50/50 sticky top-0 border-b border-gray-100 z-10"},[s("tr",null,[s("th",{class:"px-4 py-3 text-left"},"Product"),s("th",{class:"px-2 py-3 text-center"},"Qty"),s("th",{class:"px-4 py-3 text-right"},"Total")])],-1)),s("tbody",ze,[(u(!0),d(q,null,N(r.value,t=>(u(),d("tr",{key:t.id,class:"hover:bg-blue-50/20"},[s("td",Me,[s("p",Qe,p(t.name),1),s("p",Ye,"Rate: Rs. "+p(t.sale_price),1),s("div",He,[e[19]||(e[19]=s("span",{class:"text-[9px] text-yellow-600 font-bold"},"DISC:",-1)),de(s("input",{type:"number","onUpdate:modelValue":l=>t.discount=l,onInput:l=>Z(t.id),class:"w-14 h-5 border-b border-yellow-200 bg-yellow-50/50 text-[10px] text-center outline-none"},null,40,Ge),[[ue,t.discount,void 0,{number:!0}]])])]),s("td",Ke,[s("div",We,[s("div",Je,[s("button",{onClick:j(l=>W(t.id),["prevent"]),class:"px-1 text-gray-500"},"-",8,Xe),s("input",{type:"number",value:t.quantity,class:"w-6 text-center bg-transparent border-none text-[10px] font-bold p-0 focus:ring-0",onInput:l=>J(t.id,l.target.value)},null,40,Ze),s("button",{onClick:j(l=>K(t.id),["prevent"]),class:"px-1 text-gray-500"},"+",8,et)]),s("button",{onClick:l=>G(t.id),class:"text-red-400 hover:text-red-600"},[...e[20]||(e[20]=[s("i",{class:"pi pi-trash text-[10px]"},null,-1)])],8,tt)])]),s("td",st," Rs. "+p(t.quantity*t.sale_price-t.discount),1)]))),128))])]))]),s("div",at,[s("div",ot,[s("div",lt,[e[22]||(e[22]=s("span",null,"Subtotal",-1)),s("span",nt,"Rs. "+p(A.value),1)]),s("div",rt,[e[23]||(e[23]=s("span",null,"Total Discount",-1)),s("span",it,"- Rs. "+p(b.value),1)]),s("div",dt,[e[24]||(e[24]=s("span",{class:"text-sm font-bold text-gray-800"},"Grand Total",-1)),s("span",ut,"Rs. "+p(A.value-b.value),1)])]),o.isLoading?(u(),d("div",ct,[c(S(D))])):(u(),d("div",pt,[s("button",{type:"button",disabled:r.value.length===0,onClick:e[1]||(e[1]=()=>{h.value=!0,o.customer_fast_pay=!0,o.customer_invoice=!1,o.credit=!0,o.saleType="FAST_PAY"}),class:"flex flex-col items-center justify-center py-3 bg-red-600 hover:bg-red-700 disabled:bg-gray-300 text-white rounded-xl shadow-md transition-all active:scale-95"},[...e[25]||(e[25]=[s("i",{class:"pi pi-bolt text-lg mb-1"},null,-1),s("span",{class:"text-[9px] font-black uppercase"},"Fast Pay",-1)])],8,ft),s("button",{type:"button",disabled:r.value.length===0,onClick:e[2]||(e[2]=()=>{m.value=!0,o.customer_invoice=!1,w.value=!0,o.customer_fast_pay=!1,o.saleType="CREDIT",o.credit=!0}),class:"flex flex-col items-center justify-center py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 text-white rounded-xl shadow-md transition-all active:scale-95"},[...e[26]||(e[26]=[s("i",{class:"pi pi-credit-card text-lg mb-1"},null,-1),s("span",{class:"text-[9px] font-black uppercase"},"Credit",-1)])],8,gt),s("button",{type:"button",disabled:r.value.length===0,onClick:e[3]||(e[3]=()=>{m.value=!0,o.customer_invoice=!0,o.credit=!1,o.customer_fast_pay=!1,w.value=!1,o.saleType="INVOICE"}),class:"flex flex-col items-center justify-center py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-300 text-white rounded-xl shadow-md transition-all active:scale-95"},[...e[27]||(e[27]=[s("i",{class:"pi pi-user text-lg mb-1"},null,-1),s("span",{class:"text-[9px] font-black uppercase"},"Invoice",-1)])],8,xt)]))])])]),c(O,{modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=t=>h.value=t),title:"Fast Payment",onSave:e[6]||(e[6]=t=>F()),disableSaveBtn:v.value},{default:B(()=>[s("div",_t,[c(_,{id:"sale_date",type:"date",label:"Order Date",modelValue:n.sale_date,"onUpdate:modelValue":e[4]||(e[4]=t=>n.sale_date=t),errors:g.sale_date},null,8,["modelValue","errors"])])]),_:1},8,["modelValue","disableSaveBtn"]),c(O,{modelValue:m.value,"onUpdate:modelValue":e[12]||(e[12]=t=>m.value=t),title:w.value?"Credit Customer Details":"Invoice Details",onSave:e[13]||(e[13]=t=>F()),disableSaveBtn:v.value},{default:B(()=>[s("div",bt,[c(_,{id:"phone",type:"number",label:"Phone",modelValue:n.phone_one,"onUpdate:modelValue":e[7]||(e[7]=t=>n.phone_one=t),error:g.phone_one},null,8,["modelValue","error"]),c(_,{id:"name",label:"Name",modelValue:n.name,"onUpdate:modelValue":e[8]||(e[8]=t=>n.name=t),error:g.name},null,8,["modelValue","error"]),c(_,{id:"address",label:"Address",modelValue:n.address,"onUpdate:modelValue":e[9]||(e[9]=t=>n.address=t),error:g.address},null,8,["modelValue","error"]),c(_,{id:"remark",label:"Remarks",modelValue:n.remarks,"onUpdate:modelValue":e[10]||(e[10]=t=>n.remarks=t),error:g.remarks},null,8,["modelValue","error"]),c(_,{id:"sale_date",type:"date",label:"Date",modelValue:n.sale_date,"onUpdate:modelValue":e[11]||(e[11]=t=>n.sale_date=t),errors:g.sale_date},null,8,["modelValue","errors"])])]),_:1},8,["modelValue","title","disableSaveBtn"])]))}},Dt=pe(mt,[["__scopeId","data-v-922d3bd7"]]);export{Dt as default};
