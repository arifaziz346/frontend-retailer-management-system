import{a as v}from"./axios-CBe-jvwZ.js";import{_ as T}from"./Button-CUAZiNEI.js";import{k as h,r as m,s as q,l as w,m as G,c as u,a as t,b as r,u as j,q as P,z as H,F as J,x as K,A as Q,i as W,o as p,t as g}from"./index-Ce5nBVLN.js";import{V as E}from"./vue-spinner-tail-C5yLa_ls.js";import{_ as X}from"./BaseModal-REScdjHD.js";import{_ as c}from"./FormInput-lwy6tkXC.js";import{_ as Y}from"./Pagination-DNKi8Txk.js";import{t as y}from"./toast-BWxgGeSH.js";import{u as Z}from"./useFormErrors-BWkWHfi_.js";/* empty css                                                                  */import{_ as ee}from"./lodash-mI71ra8D.js";import"./stringHelpers-DhATn_QK.js";const te={key:0,class:"fixed inset-0 flex items-center justify-center bg-white/70 backdrop-blur-sm z-50"},se={class:"flex flex-col items-center space-y-3"},ae={key:1,class:"flex flex-col min-h-screen bg-gray-50 overflow-x-hidden"},le={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between bg-white border-b border-gray-200 px-4 py-3 shadow-sm rounded-lg"},oe={class:"flex items-center space-x-2 text-sm md:text-base text-gray-600"},ne={class:"flex-1 p-4 sm:p-6 md:p-8"},re={key:0,class:"flex items-center justify-center p-4"},ie={key:1},de={key:0,class:"w-full overflow-x-scroll border border-gray-300 rounded-md shadow-sm"},ue={class:"min-w-full border border-gray-200 bg-white rounded-xl overflow-hidden shadow-sm text-xs sm:text-sm md:text-base"},pe={class:"px-4 py-2 font-medium text-gray-800"},ce={class:"px-4 py-2 font-medium text-gray-900"},me={class:"px-4 py-2 text-gray-700"},xe={class:"px-4 py-2 text-gray-700"},fe={class:"px-4 py-2 text-gray-700"},be={class:"px-4 py-2 flex flex-col sm:flex-row justify-center gap-2"},ge=["onClick"],ye=["onClick"],_e=["onClick"],ve={key:1,class:"flex flex-col items-center justify-center h-[60vh] text-center"},he={class:"bg-white p-4 rounded-lg shadow-2xl space-y-2"},$=20,Le={__name:"Suppliers",setup(we){Q();const F=W(),o=h({suppliers:[],pagination:{currentPage:1,nextPageUrl:null,prevPageUrl:null,lastPage:1}}),d=m(!1),x=m(!1),f=m(!1),_=m(""),b=m(!1),N=m(""),s=h({name:"",contact_person:"",company_name:"",nic:"",address:"",account_number:"",liabilities:""}),i=h({name:"",contact_person:"",company_name:"",nic:"",address:"",account_number:"",liabilities:""}),A=Z(i),V=h({}),L=ee.debounce(()=>{x.value=!0,S()},500);q(N,()=>{L()});const S=async(a="/suppliers")=>{try{x.value?x.value=!0:d.value=!0;const n=(await v.get(a,{params:{search:N.value||null,per_page:$}})).data.data;o.suppliers=n.data||n,o.pagination.currentPage=n.current_page??1,o.pagination.lastPage=n.last_page??1,o.pagination.nextPageUrl=n.next_page_url??null,o.pagination.prevPageUrl=n.prev_page_url??null}catch(e){console.error("Error fetching suppliers:",e),y.error("Failed to fetch suppliers")}finally{d.value=!1,x.value=!1}},k=()=>{s.name="",s.contact_person="",s.phone="",s.company_name="",s.nic="",s.address="",s.account_number="",s.liabilities="",Object.keys(i).forEach(a=>i[a]=""),b.value=!1,f.value=!1,_.value=""},D=a=>{f.value=!0,_.value=a.id,s.name=a.name,s.contact_person=a.contact_person,s.phone=a.phone,s.company_name=a.company_name,s.nic=a.nic,s.address=a.address,s.account_number=a.account_number,s.liabilities=a.liabilities,b.value=!0},z=a=>{F.push({name:"admin.supplier-detail",params:{id:a.id}})},B=async()=>{d.value=!0;try{const a={name:s.name,contact_person:s.contact_person,phone:s.phone,company_name:s.company_name,nic:s.nic,address:s.address,account_number:s.account_number,liabilities:s.liabilities};let e;if(f.value){e=await v.put(`/suppliers/${_.value}`,a);const n=e.data.data??e.data.supplier??e.data,l=o.suppliers.findIndex(C=>C.id===_.value);l!==-1&&(o.suppliers[l]=n),y.success(e.data.message||"Supplier updated successfully"),k()}else{e=await v.post("/suppliers",a);const n=e.data.data??e.data.supplier??e.data;o.suppliers.unshift(n),y.success(e.data.message||"Supplier created successfully"),k()}}catch(a){console.error("Error saving/updating supplier:",a),A(a)}finally{d.value=!1}},O=async a=>{if(confirm("Are you sure you want to delete this supplier?")){d.value=!0;try{const e=await v.delete(`/suppliers/${a}`);o.suppliers=o.suppliers.filter(n=>n.id!==a),delete V[a],y.success(e.data.message||"Supplier deleted successfully")}catch(e){console.error("Error deleting supplier:",e),y.error("Failed to delete supplier")}finally{d.value=!1}}},I=w(()=>Object.values(V).reduce((a,e)=>a+(e.purchased||0),0)),M=w(()=>Object.values(V).reduce((a,e)=>a+(e.paid||0),0)),R=w(()=>(o.suppliers||[]).reduce((a,e)=>a+Number(e.liabilities||0),0));return w(()=>R.value+(I.value-M.value)),G(async()=>{await S()}),(a,e)=>{const n=H("router-link");return d.value?(p(),u("div",te,[t("div",se,[r(j(E),{size:"48px",color:"#2563eb"}),e[10]||(e[10]=t("p",{class:"text-blue-600 text-sm font-medium animate-pulse"}," Loading, please wait... ",-1))])])):(p(),u("div",ae,[t("header",le,[t("nav",oe,[r(n,{to:"/admin/Supplier",class:"flex items-center hover:text-blue-600 transition-colors"},{default:P(()=>[...e[11]||(e[11]=[t("i",{class:"pi pi-home mr-1 text-2xl"},null,-1),t("span",{class:"hidden sm:inline"},"Suppliers",-1)])]),_:1})]),r(T,{variant:"primary",size:"sm",class:"flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg shadow-sm transition-all duration-150 mt-3 sm:mt-0",onClick:e[0]||(e[0]=()=>{k(),f.value=!1,b.value=!0})},{default:P(()=>[...e[12]||(e[12]=[t("i",{class:"pi pi-plus text-sm"},null,-1),t("span",null,"Add Supplier",-1)])]),_:1})]),t("main",ne,[x.value?(p(),u("div",re,[r(j(E),{size:"32px",color:"#2563eb"}),e[13]||(e[13]=t("span",{class:"ml-2 text-blue-600 font-medium animate-pulse"},"Searching...",-1))])):(p(),u("div",ie,[o.suppliers&&o.suppliers.length?(p(),u("div",de,[e[18]||(e[18]=t("div",{class:"w-full bg bg-gray-800 text-white p-1.5"},[t("i",{class:"pi pi-home mr-1 text-md"}," Supplier List")],-1)),t("table",ue,[e[17]||(e[17]=t("thead",{class:"bg-gray-100 text-gray-700 text-xs"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left font-semibold"},"#"),t("th",{class:"px-4 py-2 text-left font-semibold"},"Supplier Name"),t("th",{class:"px-4 py-2 text-left font-semibold"},"Contact No"),t("th",{class:"px-4 py-2 text-left font-semibold"},"Company Name"),t("th",{class:"px-4 py-2 text-left font-semibold"},"Account No."),t("th",{class:"px-4 py-2 text-center font-semibold"},"Action")])],-1)),t("tbody",null,[(p(!0),u(J,null,K(o.suppliers,(l,C)=>(p(),u("tr",{key:l.id,class:"border-t border-t-gray-300 hover:bg-gray-50 transition ext-sm text-xs"},[t("td",pe,g(C+1+(o.pagination.currentPage-1)*$),1),t("td",ce,g(l.name),1),t("td",me,g(l.contact_person||"-"),1),t("td",xe,g(l.company_name||"-"),1),t("td",fe,g(l.account_number||"-"),1),t("td",be,[t("button",{onClick:U=>z(l),class:"flex flex-col sm:flex-row items-center gap-1 p-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-md shadow text-xs"},[...e[14]||(e[14]=[t("i",{class:"pi pi-eye text-base"},null,-1),t("span",null,"View",-1)])],8,ge),t("button",{onClick:U=>D(l),class:"flex flex-col sm:flex-row items-center gap-1 p-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md shadow text-xs"},[...e[15]||(e[15]=[t("i",{class:"pi pi-pencil text-base"},null,-1),t("span",null,"Edit",-1)])],8,ye),t("button",{onClick:U=>O(l.id),class:"flex flex-col sm:flex-row items-center gap-1 p-2 bg-red-500 hover:bg-red-600 text-white rounded-md shadow text-xs"},[...e[16]||(e[16]=[t("i",{class:"pi pi-trash text-base"},null,-1),t("span",null,"Delete",-1)])],8,_e)])]))),128))])]),r(Y,{pagination:o.pagination,onPageChange:S},null,8,["pagination"])])):(p(),u("div",ve,[...e[19]||(e[19]=[t("img",{src:"https://cdn-icons-png.flaticon.com/512/4076/4076549.png",alt:"No Data",class:"w-32 h-32 opacity-70 mb-4"},null,-1),t("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Suppliers Found",-1),t("p",{class:"text-gray-500"}," Try adding new suppliers to see them listed here. ",-1)])]))]))]),r(X,{modelValue:b.value,"onUpdate:modelValue":e[8]||(e[8]=l=>b.value=l),title:f.value?"Edit Supplier":"Create Supplier",onSave:e[9]||(e[9]=()=>B()),disableSaveBtn:d.value},{default:P(()=>[t("div",he,[r(c,{id:"name",label:"Name",modelValue:s.name,"onUpdate:modelValue":e[1]||(e[1]=l=>s.name=l),error:i.name},null,8,["modelValue","error"]),r(c,{id:"contact_person",label:"Contact Person",modelValue:s.contact_person,"onUpdate:modelValue":e[2]||(e[2]=l=>s.contact_person=l),error:i.contact_person},null,8,["modelValue","error"]),r(c,{id:"company_name",label:"Company Name",modelValue:s.company_name,"onUpdate:modelValue":e[3]||(e[3]=l=>s.company_name=l),error:i.company_name},null,8,["modelValue","error"]),r(c,{id:"account_number",label:"Account No.",modelValue:s.account_number,"onUpdate:modelValue":e[4]||(e[4]=l=>s.account_number=l),error:i.account_number},null,8,["modelValue","error"]),r(c,{id:"liabilities",label:"Liabilities",modelValue:s.liabilities,"onUpdate:modelValue":e[5]||(e[5]=l=>s.liabilities=l),error:i.liabilities,type:"number"},null,8,["modelValue","error"]),r(c,{id:"nic",label:"NIC",modelValue:s.nic,"onUpdate:modelValue":e[6]||(e[6]=l=>s.nic=l),error:i.nic},null,8,["modelValue","error"]),r(c,{id:"address",label:"Address",modelValue:s.address,"onUpdate:modelValue":e[7]||(e[7]=l=>s.address=l),error:i.address},null,8,["modelValue","error"])])]),_:1},8,["modelValue","title","disableSaveBtn"])]))}}};export{Le as default};
