import{r as n,z as F,j as y,l as O,c as d,a as t,b as u,u as A,g as C,e as L,t as c,F as R,q as H,n as I,h as q,o as m}from"./index-gUTQSAyF.js";import{a as g}from"./axios-BiTBWfu5.js";import{_ as G}from"./BaseModal-BRE-_Uh2.js";import{_ as k}from"./FormInput-CQaqcyQa.js";import{_ as T}from"./Pagination-k5friDJS.js";import{V as J}from"./vue-spinner-tail-BWqZ-Nnh.js";import{t as w}from"./toast-kIWbnzaY.js";import{u as K}from"./useFormErrors-BWkWHfi_.js";import"./stringHelpers-DhATn_QK.js";import"./sweetalert2.esm.all-BQxta0Da.js";const Q={key:0,class:"fixed inset-0 flex items-center justify-center bg-white/70 backdrop-blur-sm z-50"},W={class:"flex flex-col items-center space-y-3"},X={key:1,class:"flex flex-col min-h-screen bg-gray-50 overflow-x-hidden"},Y={class:"w-full bg-white/50 dark:bg-gray-800/60 rounded-lg p-3 sm:p-4 shadow-sm"},Z={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3"},ee={class:"flex items-start sm:items-center gap-3 min-w-0"},te={class:"flex items-start sm:items-center gap-3"},se={class:"min-w-0"},ae={class:"text-sm sm:text-base font-semibold leading-tight text-gray-900 dark:text-gray-100 truncate"},oe={class:"flex flex-wrap items-center gap-2 justify-start sm:justify-center w-full sm:w-auto"},re={class:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-green-50 dark:bg-green-900/20 border border-green-100 dark:border-green-800"},le={class:"text-xs sm:text-sm leading-none"},ne={class:"text-[11px] text-gray-600 dark:text-gray-300"},ie={class:"w-full sm:w-auto"},de={class:"flex-1 p-4"},ue={key:0,class:"overflow-x-auto border border-gray-300 rounded-md bg-white"},ce={class:"min-w-full text-sm"},me={class:"px-4 py-2"},pe={class:"px-4 py-2"},ge={class:"px-4 py-2"},fe={class:"px-4 py-2"},xe={class:"px-4 py-2 flex justify-center gap-2"},ye=["onClick"],ve=["onClick"],be={key:1,class:"flex flex-col items-center justify-center h-[60vh] text-center"},_e={class:"space-y-3"},Ue={__name:"Customer_Payments",setup(he){const V=F(),j=q(),v=n(V.params.id),l=n(!1),b=n(!1),p=n(!1),f=n(!1),_=n(null),h=n([]),P=y({currentPage:1,lastPage:1,nextPageUrl:null,prevPageUrl:null}),r=y({credits:[],sales:[],customer:[],shop:{name:"",address:"",phone:""},total_credit:0,total_paid:0}),o=y({customer_id:"",amount:"",paid_at:"",note:""}),i=y({amount:"",paid_at:"",note:""}),M=K(i),$=async(s=`/credit/customer/${v.value}`)=>{l.value=!0;try{const e=await g.get(s);r.credits=e.data.data.data,r.sales=e.data.data.Sales,r.customer=e.data.data.Customer,r.total_credit=e.data.data.CreditDetail.total_credit,r.total_paid=e.data.data.CreditDetail.total_paid,console.log("inside state ",r.customer)}catch(e){console.log("Error fetching customers",e)}finally{l.value=!1}},x=async(s=null)=>{try{l.value=!0;const e=await g.get(s||`/payments/customer/${v.value}`);h.value=e.data.data.data,Object.assign(P,{currentPage:e.data.data.current_page,lastPage:e.data.data.last_page,nextPageUrl:e.data.data.next_page_url,prevPageUrl:e.data.data.prev_page_url})}catch(e){console.error(e)}finally{l.value=!1}},D=()=>{p.value=!0},B=s=>{f.value=!0,_.value=s.id,o.customer_id=s.customer_id,o.amount=s.amount,o.paid_at=s.paid_at,o.note=s.note,p.value=!0},U=async()=>{let s="";b.value=!0;try{f.value?s=await g.put(`/payments/${_.value}`,o):s=await g.post("/payments",o),s.data.success&&(w.success(s.data.message),x(),E())}catch(e){M(e)}finally{b.value=!1}},N=async s=>{if(confirm("Delete this payment?")){l.value=!0;try{const e=await g.delete(`/payments/${s}`);e.data.success&&(w.success(e.data.message),x())}catch{w.error("Delete failed")}finally{l.value=!1}}},E=()=>{o.amount="",o.method="",o.paid_at="",o.note="",f.value=!1,_.value=null,Object.keys(i).forEach(s=>i[s]=""),p.value=!1},S=()=>{j.back()};return O(async()=>{$(),x(),o.customer_id=v.value}),(s,e)=>l.value?(m(),d("div",Q,[t("div",W,[u(A(J),{size:"48px",color:"#2563eb"}),e[7]||(e[7]=t("p",{class:"text-blue-600 text-sm font-medium animate-pulse"}," Loading, please wait... ",-1))])])):(m(),d("div",X,[t("div",Y,[t("div",Z,[t("div",ee,[t("button",{onClick:e[0]||(e[0]=C(a=>S(),["prevent"])),type:"button","aria-label":"Go back",class:"flex-shrink-0 w-9 h-9 rounded-full bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 flex items-center justify-center border border-gray-200 dark:border-gray-600 transition"},[...e[8]||(e[8]=[t("svg",{class:"w-4 h-4 text-gray-700 dark:text-gray-200",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","aria-hidden":"true"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M15 18l-6-6 6-6"})],-1)])]),t("div",te,[e[11]||(e[11]=t("div",{class:"flex-shrink-0"},[t("div",{class:"w-10 h-10 rounded-full bg-blue-50 dark:bg-blue-900/30 flex items-center justify-center"},[t("svg",{class:"w-5 h-5 text-blue-600 dark:text-blue-300",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","aria-hidden":"true"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zM4 20a8 8 0 0116 0"})])])],-1)),t("div",se,[t("p",ae,[e[9]||(e[9]=t("span",{class:"text-gray-500 dark:text-gray-400 font-medium mr-1"},"Name:",-1)),L(" "+c(r.customer.name),1)]),e[10]||(e[10]=t("p",{class:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 mt-0.5"},"Customer details",-1))])])]),t("div",oe,[t("div",re,[e[13]||(e[13]=t("svg",{class:"w-4 h-4 text-green-600 dark:text-green-300",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","aria-hidden":"true"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M5 12l4 4L19 6"})],-1)),t("div",le,[e[12]||(e[12]=t("div",{class:"font-semibold text-green-700 dark:text-green-200"},"Paid",-1)),t("div",ne,"Rs."+c(r.total_paid),1)])])]),t("div",ie,[t("button",{onClick:e[1]||(e[1]=C(a=>D(),["prevent"])),type:"button",class:"w-full sm:w-auto inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-medium shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-300 transition","aria-label":"Open payment dialog"},[...e[14]||(e[14]=[t("svg",{class:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","aria-hidden":"true"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M3 10h18M7 6h10l1 2H6l1-2zM5 18h14a2 2 0 002-2V8H3v8a2 2 0 002 2z"})],-1),t("span",{class:"text-sm"},"Make Payment",-1)])])])])]),t("main",de,[h.value.length?(m(),d("div",ue,[t("table",ce,[e[15]||(e[15]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left"},"#ID"),t("th",{class:"px-4 py-2 text-left"},"Amount"),t("th",{class:"px-4 py-2 text-left"},"Paid Date"),t("th",{class:"px-4 py-2 text-left"},"Note"),t("th",{class:"px-4 py-2 text-center"},"Actions")])],-1)),t("tbody",null,[(m(!0),d(R,null,H(h.value,a=>(m(),d("tr",{key:a.payment_id,class:"border-t border-gray-300 hover:bg-gray-50"},[t("td",me,c(a.id),1),t("td",pe,"Rs. "+c(a.amount),1),t("td",ge,c(a.paid_at),1),t("td",fe,c(a.note||"-"),1),t("td",xe,[t("button",{class:"bg-blue-600 text-white px-3 py-1 rounded",onClick:z=>B(a)}," Edit ",8,ye),t("button",{class:"bg-red-500 text-white px-3 py-1 rounded",onClick:z=>N(a.id)}," Delete ",8,ve)])]))),128))])]),u(T,{class:"m-0.5",pagination:P,onPageChange:e[2]||(e[2]=a=>x())},null,8,["pagination"])])):(m(),d("div",be,[...e[16]||(e[16]=[t("img",{src:"https://cdn-icons-png.flaticon.com/512/4076/4076549.png",alt:"No Data",class:"w-32 h-32 opacity-70 mb-4"},null,-1),t("h2",{class:"text-xl font-semibold text-gray-700 mb-2"},"No Payments Found",-1),t("p",{class:"text-gray-500"},null,-1)])]))]),u(G,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=a=>p.value=a),title:f.value?"Edit Payment":"Add Payment",onSave:U,disableSaveBtn:b.value},{default:I(()=>[t("div",_e,[u(k,{modelValue:o.amount,"onUpdate:modelValue":e[3]||(e[3]=a=>o.amount=a),label:"Amount",type:"number",error:i.amount},null,8,["modelValue","error"]),u(k,{modelValue:o.paid_at,"onUpdate:modelValue":e[4]||(e[4]=a=>o.paid_at=a),label:"Paid Date",type:"date",error:i.paid_at},null,8,["modelValue","error"]),u(k,{modelValue:o.note,"onUpdate:modelValue":e[5]||(e[5]=a=>o.note=a),label:"Note",error:i.note},null,8,["modelValue","error"])])]),_:1},8,["modelValue","title","disableSaveBtn"])]))}};export{Ue as default};
